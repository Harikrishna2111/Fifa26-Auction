<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Player Trading</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body style="background:#1c1f26; color:white; min-height:100vh;">

<nav class="navbar navbar-dark bg-dark px-4">
    <span class="navbar-brand">üîÅ Trade Players</span>
    <a href="/auction/{{ lobby_code }}" class="btn btn-outline-light btn-sm">
        Back to Auction
    </a>
</nav>

<div class="container mt-4">

    <div class="row">

        <!-- Your Team -->
        <div class="col-md-4">
            <div class="card p-3 text-dark shadow" style="border-radius:15px;">
                <h5 class="text-center">Your Team</h5>

                {% for p in my_team %}
                <div class="border rounded p-2 mb-2">
                    <b>{{ p.name }}</b> ({{ p.position }})<br>
                    Bought for ‚Çπ{{ p.price }}
                </div>
                {% endfor %}

                <p class="mt-3">
                    Remaining Budget: <b>‚Çπ {{ my_budget }}</b>
                </p>
            </div>
        </div>

        <!-- Trade Form -->
        <div class="col-md-4">
            <div class="card p-3 shadow" style="border-radius:15px;">
                <h5 class="text-center">Create Trade Offer</h5>

                <form method="POST" action="/trade/{{ lobby_code }}">

                    <label class="mt-2">Offer Your Player (optional)</label>
                    <select class="form-select">
                        <option value="">None</option>
                        {% for p in my_team %}
                        <option>{{ p.name }}</option>
                        {% endfor %}
                    </select>

                    <label class="mt-3">Request Player</label>
                    <select class="form-select">
                        {% for t in other_teams %}
                            {% for p in t.players %}
                            <option>{{ p.name }} ({{ t.name }})</option>
                            {% endfor %}
                        {% endfor %}
                    </select>

                    <label class="mt-3">Money Offer (‚Çπ)</label>
                    <input type="number" class="form-control" placeholder="Enter amount">

                    <button class="btn btn-success w-100 mt-4">
                        Send Trade Offer
                    </button>
                </form>
            </div>
        </div>

        <!-- Incoming Trades -->
        <div class="col-md-4">
            <div class="card p-3 shadow" style="border-radius:15px;">
                <h5 class="text-center">Incoming Trade Requests</h5>

                {% for trade in incoming_trades %}
                <div class="border rounded p-2 mb-3">
                    <p>
                        <b>{{ trade.from_team }}</b> offers
                        <br>
                        Player: {{ trade.offer_player or "None" }}
                        <br>
                        Money: ‚Çπ{{ trade.money }}
                        <br>
                        Wants: {{ trade.request_player }}
                    </p>

                    <div class="d-flex gap-2">
                        <button class="btn btn-success btn-sm w-50">Accept</button>
                        <button class="btn btn-danger btn-sm w-50">Reject</button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

    </div>

</div>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
const socket = io();

socket.on("trade_received", trade => {
    console.log("New trade:", trade);
});

socket.on("trade_completed", trade => {
    alert("Trade completed successfully!");
});

socket.on("trade_rejected", trade => {
    alert("Trade rejected");
});
</script>

</body>
</html>
