<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lobby {{ lobby_id }}</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body style="background:#203a43; min-height:100vh;">

<div class="container py-5">
    <div class="card p-4">

        <h3 class="text-center">üèü Auction Lobby</h3>

        <p class="text-center mt-3">
            <strong>Lobby Code:</strong>
            <span class="badge bg-dark">{{ lobby_id }}</span>
        </p>

        <p class="text-center">
            <strong>You:</strong> {{ username }}
        </p>

        <hr>

        <h5>Players in Lobby</h5>
        <ul id="playerList" class="list-group mb-3"></ul>

        {% if is_admin %}
        <button class="btn btn-success w-100" onclick="startAuction()">
            Start Auction
        </button>
        {% else %}
        <p class="text-muted text-center">
            Waiting for admin to start auction‚Ä¶
        </p>
        {% endif %}
    </div>
</div>

<!-- Socket.IO -->
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<script>
const socket = io();

// üî¥ THIS WAS MISSING ‚Äî NOW FIXED
socket.emit("join_lobby", {
    lobby: "{{ lobby_id }}",
    user: "{{ username }}"
});

socket.on("lobby_update", data => {
    const list = document.getElementById("playerList");
    list.innerHTML = "";
    data.players.forEach(p => {
        const li = document.createElement("li");
        li.className = "list-group-item";
        li.textContent = p;
        list.appendChild(li);
    });
});

function startAuction() {
    socket.emit("start_auction", {
        lobby_code: "{{ lobby_id }}"
    });
}
</script>

</body>
</html>
